var docson=docson||{};docson.templateBaseUrl="templates",define(["/lib/jquery.js","/lib/handlebars.min.js","/lib/highlight.min.js","/lib/jsonpointer.min.js","/lib/marked.min.js","/lib/traverse.min.js"],function(e,n,t,r,i){function a(e){if(-1==p.indexOf(e)){p.push(e);var n=new Handlebars.SafeString(s(e));return p.pop(),n}return new Handlebars.SafeString(s({description:"_circular reference_"}))}function o(){$.when($.get(docson.templateBaseUrl+"/box.html").done(function(e){d=e,s=Handlebars.compile(d)}),$.get(docson.templateBaseUrl+"/signature.html").done(function(e){d=e,l=Handlebars.compile(d)})).always(function(){f.resolve()})}var s,l,d,f=$.Deferred(),p=[],u=[];Handlebars.registerHelper("scope",function(e,n){var t;return u.push([]),e&&(e.id||e.root)?(p.push(e),t=n.fn(this),p.pop()):t=n.fn(this),u.pop(),t}),Handlebars.registerHelper("source",function(e){return delete e.root,delete e.__boxId,delete e.__name,delete e.__ref,JSON.stringify(e,null,2)}),Handlebars.registerHelper("desc",function(e){var n=e.description;if(!n)return"";var t=n;return i?(i.setOptions({gfm:!0,breaks:!0}),new Handlebars.SafeString(i(t))):t}),Handlebars.registerHelper("equals",function(e,n,t){if(arguments.length<3)throw new Error("Handlebars Helper equals needs 2 parameters");return e!=n?t.inverse(this):t.fn(this)}),Handlebars.registerHelper("contains",function(e,n,t){if(e&&e instanceof Array&&-1!=e.indexOf(n))return t.fn(this)}),Handlebars.registerHelper("primitive",function(e,n){if(e.type&&"object"!=e.type&&"array"!=e.type||e.enum)return b(this,n,!0)}),Handlebars.registerHelper("exists",function(e,n){if(void 0!==e){e=null===e?"null":e,e=!0===e?"true":e,e=!1===e?"false":e,e="object"==typeof e?JSON.stringify(e):e,this.__default=e;var t=n.fn(this);return delete this.__default,t}}),Handlebars.registerHelper("range",function(e,n,t,r,i,a,o){var s="";if(void 0!==e||void 0!==n)return s+=i?"]":"[",s+=void 0!==e?e:t,(e||t)!==(n||r)&&(s+=void 0===e&&null===t||void 0===n&&null===r?"":o,s+=void 0!==n?n:r),s+=a?"[":"]",s});var c=function(e){return"array"==e.type||e.allOf||e.anyOf||e.oneOf||e.not};Handlebars.registerHelper("sub",function(e,n){if(c(e)||e.type&&"object"!=e.type&&"array"!=e.type||e.enum)return n.fn(this)}),Handlebars.registerHelper("main",function(e,n){if(!c(e))return n.fn(this)});var h=function(e){var n=void 0===e.description&&void 0===e.title&&void 0===e.id;return n&=void 0===e.properties,n};Handlebars.registerHelper("simple",function(e,n){if(h(e)&&!e.$ref)return b(e,n,!0)});var b=function(e,n,t){e.__type=e.type,e.type||t||(e.__type="any"),e.format&&(e.__type=e.format),"any"!=e.__type&&"object"!=e.__type||!e.title||(e.__type=e.title);var r=n.fn(e);return delete e.__type,r};Handlebars.registerHelper("complex",function(e,n){if(!h(e)&&!e.$ref||e.properties)return b(e,n)}),Handlebars.registerHelper("enum",function(e){if(e.enum)return e.enum.length>1?"enum":"constant"}),Handlebars.registerHelper("obj",function(e,n){if(e.properties||"object"==e.type)return b(e,n)});var g=function(e){u[u.length-1].push(e)};Handlebars.registerHelper("box",function(e,n){if(e)return g(e),n.fn(e)}),Handlebars.registerHelper("boxId",function(){return u[u.length-1].length}),Handlebars.registerHelper("boxes",function(e){var n="";return $.each(u[u.length-1],function(t,r){r.__boxId=t+1,n+=e.fn(r)}),u[u.length-1]=[],n});var v=function(e){var n;if(p)for(n=p.length-1;n>=0;n--)if(p[n][e])return p[n][e];return null},y=function(e){var n=p[1];if("#"==e)return n;try{return r.get(p[1],e)}catch(e){return console.log(e),null}},H=function(e){return 0==e.indexOf("#")?y(e):v(e)},m=function(e){if(!e)return"<error>";var n=e.title;return n=!n&&e.id?e.id:n,n=n||e.__name,n};Handlebars.registerHelper("name",function(e,n){if(e.__name=m(e),e.__name)return n.fn(e)});var x=function(e){var n=m(H(e));n||(n="#"==e?"<root>":e.replace("#","/"));var t=n.split("/");return n=t[t.length-1],n};return Handlebars.registerHelper("ref",function(e,n){if(e.$ref){var t,r=H(e.$ref);return r&&(r.__name=x(e.$ref),r.__ref=e.$ref.replace("#","")),t=r?n.fn(r):new Handlebars.SafeString("<span class='signature-type-ref'>"+e.$ref+"</span>"),r&&delete r.__ref,t}}),Handlebars.registerHelper("schema",function(e){return a(e)}),Handlebars.registerHelper("signature",function(e,n,t){return t||(t=[]),t=t instanceof Array?t:[t],new Handlebars.SafeString(l({schema:e,keyword:n,schemas:t}))}),Handlebars.registerHelper("l",function(e){console.log(e)}),docson.doc=function(e,n,t,i){var a=$.Deferred();return void 0===i&&(i=""),docson.templateBaseUrl=i+"docson",o(),f.done(function(){"string"==typeof e&&(e=$("#"+e)),"string"==typeof n&&(n=JSON.parse(n));$.Deferred().resolve().promise();var o={},l=function(){function i(){if(d){var n=e.find(".box").first();e.get(0).onresize(n.outerWidth(),n.outerHeight())}}p.push(o);var a=n;t&&(t="/"!==t[0]?"/"+t:t,a=r.get(n,t),p.push(n)),a.root=!0,a.__ref="<root>";var l=s(a);t&&p.pop(),p.pop(),e.addClass("docson").html(l);var d=e.get(0).onresize;e.get(0).resized=i,i(),e.find(".box-title").each(function(){var e=$(this).attr("ref");e&&window.location.href.indexOf("docson/index.html")>-1&&$(this).find(".box-name").css("cursor","pointer").attr("title","Open in new window").hover(function(){$(this).addClass("link")},function(){$(this).removeClass("link")}).click(function(){function t(e){e.data.id&&"docson"==e.data.id&&"ready"==e.data.action&&r.postMessage({id:"docson",action:"load",definitions:n,type:e.data.url.split("$")[1],expand:!0},"*")}var r,i=window.location.href+"$$expand";"<root>"!==e&&(i=i.replace(/(docson\/index.html#[^\$]*).*/,"$1$"+e+"$$expand")),window.addEventListener("message",t,!1),r=window.open(i,"_blank")})}),e.find(".box").mouseenter(function(){$(this).children(".source-button").fadeIn(300),$(this).children(".box-body").children(".expand-button").fadeIn(300)}),e.find(".box").mouseleave(function(){$(this).children(".source-button").fadeOut(300),$(this).children(".box-body").children(".expand-button").fadeOut(300)}),e.find(".signature-type-expandable").click(function(){var e=$(this).attr("boxid");$(this).toggleClass("signature-type-expanded"),$(this).parent().parent().parent().children(".signature-box-container").children("[boxid='"+e+"']").toggle(d?0:300),i()}),e.find(".expand-button").click(function(){$(this).attr("expanded")?($(this).parent().parent().find(".expand-button").html(" + ").attr("title","Expand all"),$(this).parent().parent().find(".signature-type-expandable").removeClass("signature-type-expanded"),$(this).parent().parent().find(".box-container").hide(d?0:300),$(this).parent().parent().find(".expand-button").removeAttr("expanded"),i()):($(this).parent().parent().find(".expand-button").html(" - ").attr("title","Collapse all"),$(this).parent().parent().find(".signature-type-expandable").addClass("signature-type-expanded"),$(this).parent().parent().find(".box-container").show(d?0:300),$(this).parent().parent().find(".expand-button").attr("expanded",!0),i())}),e.find(".source-button").click(function(){$(this).parent().children(".box-body").toggle(),$(this).parent().children(".source").toggle(),i()})},d=function(e){traverse(e).forEach(function(e){if(e&&"array"==e.$ref&&(delete e.$ref,e.type="array"),"$ref"===this.key){var n=!1,t=!1;if(/^https?:\/\//.test(e)?n=!0:/^[^#]/.test(e)?t=!0:e.indexOf("#")>0&&(n=!0,e=i+e,this.update(e)),n){var r=e.split("#");o[e]=null;$.get(r[0]).then(function(n){if("object"!=typeof n)try{n=JSON.parse(n)}catch(e){console.error("Unable to parse "+r[0],e)}n&&(o[e]=n,l(),d(n))})}else if(t){r=e.split("#");o[e]=null;$.get(i+r[0]).then(function(n){if("object"!=typeof n)try{n=JSON.parse(n)}catch(e){console.error("Unable to parse "+r[0],e)}n&&(o[e]=n,l(),d(n))})}}})};d(n),l(),a.resolve()}),a.promise()},docson});